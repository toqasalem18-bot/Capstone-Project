{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ’« JoyLine â€“ Moments of Joy</title>
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<style>
/* ===== Body & Dark Mode ===== */
body { font-family:'Segoe UI', sans-serif; margin:0; padding:0; background:#f5f7fa; color:#111827; transition:0.3s;}
body.dark-mode { background:#121212; color:#f5f5f5; }

/* ===== Header & Nav ===== */
header { background:#1e40af; color:#fff; padding:15px 50px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 12px rgba(0,0,0,0.12); position:sticky; top:0; z-index:1000; }
.logo { font-size:2rem; font-weight:700; }
nav ul { list-style:none; display:flex; gap:20px; margin:0; padding:0; align-items:center; }
nav ul li a, nav ul li button { color:#fff; text-decoration:none; font-weight:600; background:none; border:none; cursor:pointer; padding:8px 18px; border-radius:30px; transition:0.3s; font-size:0.95rem; line-height:1.2; }
nav ul li a:hover, nav ul li button:hover { background:#3b82f6; transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.2); }
nav ul li form { margin:0; }

/* ===== Dropdown ===== */
.dropdown { position:relative; }
.dropdown-content { display:none; position:absolute; right:0; top:35px; background:#fff; min-width:260px; box-shadow:0 6px 18px rgba(0,0,0,0.2); border-radius:8px; z-index:10; max-height:350px; overflow-y:auto; }
body.dark-mode .dropdown-content { background:#1f2937; }
.dropdown-content a, .dropdown-content form button { display:block; padding:10px 15px; text-decoration:none; color:#1e40af; border:none; background:none; width:100%; text-align:left; cursor:pointer; font-size:0.95rem; }
.dropdown-content a.unread { font-weight:bold; }
.dropdown-content a:hover, .dropdown-content form button:hover { background:#dbeafe; }
body.dark-mode .dropdown-content a, body.dark-mode .dropdown-content form button { color:#f5f5f5; }
body.dark-mode .dropdown-content a:hover, body.dark-mode .dropdown-content form button:hover { background:#374151; }

/* Badge */
.notif-badge { position:absolute; top:-5px; right:-8px; background:#ef4444; color:#fff; border-radius:50%; font-size:0.7rem; padding:2px 6px; }

/* Container & Footer */
.container { width:90%; max-width:1000px; margin:60px auto; display:flex; flex-direction:column; gap:25px; }
footer { text-align:center; margin:50px 0 20px 0; padding:20px 0; color:#555; font-size:0.9rem; border-top:1px solid #e0e0e0; background:#fff; }
body.dark-mode footer { background:#111; color:#ccc; }
@media(max-width:768px) { header { flex-direction:column; align-items:flex-start; gap:10px; padding:15px 20px; } nav ul { flex-wrap:wrap; gap:10px; } .container{width:95%; margin:20px auto;} }
</style>
</head>
<body>
<header>
    <div class="logo">ðŸ’« JoyLine</div>
    <nav>
        <ul>
            <li><a href="{% url 'postbox:timeline' %}">Home</a></li>
            {% if user.is_authenticated %}
                <li><a href="{% url 'postbox:event_create' %}">Add Event</a></li>
                <li><a href="{% url 'postbox:my_events' %}">My Events</a></li>

                <!-- User Dropdown -->
                <li class="dropdown">
                    <button id="user-menu-btn" style="font-size:1.2rem; line-height:1;">â‹®</button>
                    <div class="dropdown-content" id="user-dropdown">
                        <!-- Dark Mode -->
                        <a href="#" id="toggle-dark-mode">Dark Mode</a>

                        <!-- Notifications -->
                        <div style="position:relative;">
                            <a href="#" id="notif-toggle">Notifications</a>
                            {% if unread_count > 0 %}
                                <span class="notif-badge" id="notif-badge">{{ unread_count }}</span>
                            {% endif %}
                            <div class="dropdown-content" id="notif-dropdown" style="top:35px; right:0;">
                                {% if all_notifications %}
                                    {% for notif in all_notifications %}
                                        <a href="{{ notif.link }}" class="{% if not notif.is_read %}unread{% endif %}">
                                            {{ notif.message }}<br>
                                            <small>{{ notif.created_at|date:"M d, H:i" }}</small>
                                        </a>
                                    {% endfor %}
                                {% else %}
                                    <p style="padding:10px;text-align:center;color:#888;">No notifications yet.</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Logout -->
                        <form action="{% url 'postbox:logout' %}" method="post">{% csrf_token %}
                            <button type="submit">Logout</button>
                        </form>
                    </div>
                </li>
            {% else %}
                <li><a href="{% url 'postbox:login' %}">Login</a></li>
                <li><a href="{% url 'postbox:signup' %}">Register</a></li>
            {% endif %}
        </ul>
    </nav>
</header>

<div class="container">
    {% block content %}{% endblock %}
</div>

<footer>
    <p>Â© 2025 JoyLine â€“ Share your happy moments</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function(){

    
    document.getElementById('toggle-dark-mode')?.addEventListener('click', function(e){
        e.preventDefault();
        document.body.classList.toggle('dark-mode');
    });

    
    const userMenuBtn = document.getElementById('user-menu-btn');
    const userDropdown = document.getElementById('user-dropdown');
    const notifToggle = document.getElementById('notif-toggle');
    const notifDropdown = document.getElementById('notif-dropdown');
    const notifBadge = document.getElementById('notif-badge');

  
    userMenuBtn?.addEventListener('click', function(e){
        e.preventDefault();
        userDropdown.style.display = (userDropdown.style.display === 'block') ? 'none' : 'block';
    });

    
    notifToggle?.addEventListener('click', function(e){
        e.preventDefault();
        const isVisible = notifDropdown.style.display === 'block';
        notifDropdown.style.display = isVisible ? 'none' : 'block';
        if(!isVisible && notifBadge){
            notifBadge.style.display = 'none'; 
        }
    });

    document.addEventListener('click', function(e){
        if(!userDropdown.contains(e.target) && !userMenuBtn.contains(e.target)){
            userDropdown.style.display = 'none';
            notifDropdown.style.display = 'none';
        }
    });
});
</script>
</body>
</html>
