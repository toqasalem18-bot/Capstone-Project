{% extends 'postbox/base.html' %}
{% load static %}

{% block content %}
<div class="event-form-container">
    <h2>Edit Event</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-group">
            {{ form.title.label_tag }}
            {{ form.title }}
            {{ form.title.errors }}
        </div>

        <div class="form-group">
            {{ form.description.label_tag }}
            {{ form.description }}
            {{ form.description.errors }}
        </div>

        <div class="form-group">
            {{ form.event_date.label_tag }}
            {{ form.event_date }}
            {{ form.event_date.errors }}
        </div>

        <div class="form-group">
            {{ form.event_type.label_tag }}
            {{ form.event_type }}
            {{ form.event_type.errors }}
        </div>

        <div class="form-group" id="custom_event_container" style="display:none;">
            {{ form.custom_event_type.label_tag }}
            {{ form.custom_event_type }}
            {{ form.custom_event_type.errors }}
        </div>

        <div class="form-group">
            <label for="id_image">Event Image:</label>
            {{ form.image }}
            {% if form.instance.image %}
            <div class="current-image-wrapper" style="margin-top:8px;">
                <img id="current-event-image" src="{{ form.instance.image.url }}" alt="Current Event Image" style="max-width:200px; border-radius:8px; display:block; margin-bottom:8px;">
                <button type="button" id="remove-image-btn" class="btn btn-clear">Remove Image</button>
                <input type="hidden" name="remove_image" id="remove_image" value="0">
            </div>
            {% endif %}
        </div>

        <div class="form-actions" style="margin-top:20px;">
            <button type="submit" class="btn btn-update">Update</button>
            <a href="{% url 'postbox:timeline' %}" class="btn btn-cancel">Cancel</a>
        </div>
    </form>
</div>

<style>
.btn-clear {
    background: #f87171;
    color: #fff;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.85rem;
    margin-top: 4px;
    cursor: pointer;
}
.btn-clear:hover { opacity: 0.9; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function(){
    const select = document.getElementById('event_type_select');
    const customContainer = document.getElementById('custom_event_container');

    if(select){
        function toggleCustomField(){
            if(select.value === 'other'){
                customContainer.style.display = 'block';
            } else {
                customContainer.style.display = 'none';
            }
        }
        select.addEventListener('change', toggleCustomField);
        toggleCustomField();
    }

    // Remove button
    const removeBtn = document.getElementById('remove-image-btn');
    const imageInput = document.getElementById('id_image');
    const currentImage = document.getElementById('current-event-image');
    const removeInput = document.getElementById('remove_image');

    if(removeBtn){
        removeBtn.addEventListener('click', function(){
            if(currentImage) currentImage.style.display = 'none';
            if(imageInput) imageInput.value = '';
            if(removeInput) removeInput.value = '1';
        });
    }
});
</script>
{% endblock %}
