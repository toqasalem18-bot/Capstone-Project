{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ’« JoyLine â€“ Moments of Joy</title>
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<style>
/* ===== Body & Dark Mode ===== */
body {
    font-family:'Segoe UI', sans-serif;
    margin:0; padding:0;
    background:#f8fafc; color:#111827;
    transition:0.3s;
}
body.dark-mode { background:#121212; color:#f5f5f5; }


header {
    background: linear-gradient(120deg, #f4f3ff, #fef6f9, #f0f9ff);
    background-size: 300% 300%;
    animation: gradientShift 12s ease infinite;
    color:#1e293b;
    padding:24px 65px; 
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 3px 20px rgba(0,0,0,0.08);
    position:sticky;
    top:0;
    z-index:1000;
    border-radius:0 0 25px 25px;
    transition:all 0.4s ease;
}
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
header.scrolled {
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
    padding:15px 60px;
    background: linear-gradient(135deg, #ede9fe, #fdf2f8, #dbeafe);
    background-size: 200% 200%;
}
body.dark-mode header {
    background: linear-gradient(120deg, #1f2937, #334155, #475569);
    background-size: 300% 300%;
    animation: gradientShiftDark 14s ease infinite;
    color:#f1f5f9;
}
@keyframes gradientShiftDark {
    0% { background-position: 0% 0%; }
    50% { background-position: 100% 100%; }
    100% { background-position: 0% 0%; }
}

/* ===== Logo ===== */
.logo {
    font-size:2.5rem;
    font-weight:700;
    transition:transform 0.4s ease, color 0.3s;
}
.logo:hover {
    transform:scale(1.1) rotate(-2deg);
    color:#8b5cf6;
}

/* ===== Nav Buttons ===== */
nav ul { list-style:none; display:flex; gap:25px; margin:0; padding:0; align-items:center; }
nav ul li a, nav ul li button {
    color:#1e293b; text-decoration:none; font-weight:600;
    background:none; border:none; cursor:pointer;
    padding:10px 20px; border-radius:35px;
    position:relative; overflow:hidden; transition:0.3s;
    font-size:1rem; line-height:1.2;
}
body.dark-mode nav ul li a, body.dark-mode nav ul li button { color:#f1f5f9; }

/* Hover Glow */
nav ul li a:hover, nav ul li button:hover {
    color:#6d28d9;
    box-shadow:0 0 12px rgba(139,92,246,0.4);
    transform:translateY(-2px);
}

/* ===== Dropdowns ===== */
.dropdown { position:relative; }
.dropdown-content {
    display:none; position:absolute; right:0; top:45px;
    background:#fff; min-width:260px;
    box-shadow:0 8px 25px rgba(0,0,0,0.2);
    border-radius:12px; z-index:10; max-height:350px; overflow-y:auto;
}
body.dark-mode .dropdown-content { background:#1f2937; }
.dropdown-content a, .dropdown-content form button {
    display:block; padding:12px 15px; text-decoration:none;
    color:#1e40af; border:none; background:none; width:100%;
    text-align:left; cursor:pointer; font-size:0.95rem;
}
.dropdown-content a.unread { font-weight:bold; }
.dropdown-content a:hover, .dropdown-content form button:hover { background:#dbeafe; }
body.dark-mode .dropdown-content a, body.dark-mode .dropdown-content form button { color:#f5f5f5; }
body.dark-mode .dropdown-content a:hover, body.dark-mode .dropdown-content form button:hover { background:#374151; }

.notif-badge {
    position:absolute; top:-6px; right:-8px;
    background:#ef4444; color:#fff; border-radius:50%;
    font-size:0.7rem; padding:2px 6px;
    animation:pulse 1.8s infinite;
}
@keyframes pulse {
    0% { box-shadow:0 0 0 0 rgba(239,68,68,0.6); }
    70% { box-shadow:0 0 0 10px rgba(239,68,68,0); }
    100% { box-shadow:0 0 0 0 rgba(239,68,68,0); }
}

/* ===== Footer ===== */
.container { width:90%; max-width:1000px; margin:60px auto; display:flex; flex-direction:column; gap:25px; }
footer {
    text-align:center; margin:50px 0 20px 0; padding:20px 0;
    color:#555; font-size:0.9rem;
    border-top:1px solid #e0e0e0; background:#fff;
}
body.dark-mode footer { background:#111; color:#ccc; }

@media(max-width:768px){
    header{flex-direction:column;align-items:flex-start;gap:10px;padding:20px 25px;}
    nav ul{flex-wrap:wrap;gap:12px;}
    .container{width:95%;margin:20px auto;}
}
</style>
</head>

<body>
<header id="main-header">
    <div class="logo">ðŸ’« JoyLine</div>
    <nav>
        <ul>
            <li><a href="{% url 'postbox:timeline' %}">Home</a></li>
            {% if user.is_authenticated %}
                <li><a href="{% url 'postbox:event_create' %}">Add Event</a></li>
                <li><a href="{% url 'postbox:my_events' %}">My Events</a></li>
                <li><a href="{% url 'postbox:future_events_view' %}"> Future Events</a></li>


                <li class="dropdown">
                    <button id="user-menu-btn">â‹®</button>
                    <div class="dropdown-content" id="user-dropdown">
                        <a href="#" id="toggle-dark-mode">Dark Mode</a>
                        <div style="position:relative;">
                            <a href="#" id="notif-toggle">Notifications</a>
                            {% if unread_count > 0 %}
                                <span class="notif-badge" id="notif-badge">{{ unread_count }}</span>
                            {% endif %}
                            <div class="dropdown-content" id="notif-dropdown" style="top:45px; right:0;">
                                {% if all_notifications %}
                                    {% for notif in all_notifications %}
                                        <a href="{{ notif.link }}" class="{% if not notif.is_read %}unread{% endif %}">
                                            {{ notif.message }}<br>
                                            <small>{{ notif.created_at|date:"M d, H:i" }}</small>
                                        </a>
                                    {% endfor %}
                                {% else %}
                                    <p style="padding:10px;text-align:center;color:#888;">No notifications yet.</p>
                                {% endif %}
                            </div>
                        </div>
                        <form action="{% url 'postbox:logout' %}" method="post">{% csrf_token %}
                            <button type="submit">Logout</button>
                        </form>
                    </div>
                </li>
            {% else %}
                <li><a href="{% url 'postbox:login' %}">Login</a></li>
                <li><a href="{% url 'postbox:signup' %}">Register</a></li>
            {% endif %}
        </ul>
    </nav>
</header>

<div class="container">
    {% block content %}{% endblock %}
</div>

<footer>
    <p>Â© 2025 JoyLine â€“ Share your happy moments</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function(){
    const userMenuBtn = document.getElementById('user-menu-btn');
    const userDropdown = document.getElementById('user-dropdown');
    const notifToggle = document.getElementById('notif-toggle');
    const notifDropdown = document.getElementById('notif-dropdown');
    const notifBadge = document.getElementById('notif-badge');
    const header = document.getElementById('main-header');

    // Dark mode 
    document.getElementById('toggle-dark-mode')?.addEventListener('click', e => {
        e.preventDefault();
        document.body.classList.toggle('dark-mode');
    });

  
    userMenuBtn?.addEventListener('click', e => {
        e.preventDefault();
        userDropdown.style.display = (userDropdown.style.display === 'block') ? 'none' : 'block';
    });

    // Notification 
    notifToggle?.addEventListener('click', e => {
        e.preventDefault();
        const isVisible = notifDropdown.style.display === 'block';
        notifDropdown.style.display = isVisible ? 'none' : 'block';
        if(!isVisible && notifBadge) notifBadge.style.display = 'none';
    });


    document.addEventListener('click', e => {
        if(!userDropdown.contains(e.target) && !userMenuBtn.contains(e.target)){
            userDropdown.style.display='none';
            notifDropdown.style.display='none';
        }
    });

    
    window.addEventListener('scroll', function(){
        if(window.scrollY > 50){ header.classList.add('scrolled'); }
        else{ header.classList.remove('scrolled'); }
    });
});
</script>
</body>
</html>
